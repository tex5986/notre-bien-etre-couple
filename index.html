<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notre Journ√©e Bien-√ätre üíï - Synchronis√©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            color: #333;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }
        
        .sync-info {
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .sync-status {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .sync-online {
            background: #00b894;
            color: white;
            animation: pulse 2s infinite;
        }
        
        .sync-offline {
            background: #fd79a8;
            color: white;
        }
        
        .sync-connecting {
            background: #fdcb6e;
            color: #333;
            animation: blink 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }
        
        .firebase-info {
            background: rgba(46, 125, 50, 0.1);
            border: 2px solid #4caf50;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .quick-nav {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            position: relative;
        }
        
        .puzzle-container {
            position: relative;
            width: 200px;
            height: 200px;
        }
        
        .nav-btn {
            position: absolute;
            width: 100px;
            height: 100px;
            border: none;
            font-weight: bold;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            line-height: 1.2;
        }
        
        .nav-btn-1 {
            top: 0;
            left: 0;
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            color: #4a4a4a;
            clip-path: polygon(0% 0%, 85% 0%, 100% 35%, 85% 50%, 100% 65%, 85% 100%, 0% 100%);
        }
        
        .nav-btn-2 {
            top: 0;
            right: 0;
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            color: #4a4a4a;
            clip-path: polygon(15% 0%, 100% 0%, 100% 100%, 0% 100%, 15% 65%, 0% 50%, 15% 35%);
        }
        
        .nav-btn-history {
            bottom: 0;
            left: 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            clip-path: polygon(0% 0%, 85% 0%, 100% 35%, 85% 50%, 100% 65%, 85% 100%, 0% 100%);
        }
        
        .nav-btn-tech {
            bottom: 0;
            right: 0;
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            color: #4a4a4a;
            clip-path: polygon(15% 0%, 100% 0%, 100% 100%, 0% 100%, 15% 65%, 0% 50%, 15% 35%);
        }
        
        .nav-btn:hover {
            transform: scale(1.05);
            z-index: 10;
        }
        
        .nav-btn:active {
            transform: scale(0.95);
        }
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            color: #856404;
        }
        
        .share-link {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 11px;
            word-break: break-all;
            margin: 10px 0;
            border: 2px dashed #667eea;
        }
        
        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin: 5px;
        }
        
        .quote {
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-style: italic;
            color: #555;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
        }
        
        .person-section {
            padding: 30px;
        }
        
        .person-section:first-child {
            border-right: 3px solid #f1f2f6;
            background: linear-gradient(135deg, #a8edea, #fed6e3);
        }
        
        .person-section:last-child {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
        }
        
        .person-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
            color: #4a4a4a;
        }
        
        .score-display {
            background: rgba(255,255,255,0.8);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .score-number {
            font-size: 2em;
            font-weight: bold;
            color: #ff6b9d;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            background: rgba(255,255,255,0.6);
            height: 15px;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b9d, #4ecdc4);
            border-radius: 10px;
            transition: all 0.5s ease;
        }
        
        .milestone {
            background: #ffd700;
            color: #333;
            padding: 10px;
            border-radius: 10px;
            margin: 8px 0;
            text-align: center;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .milestone.achieved {
            background: #00b894;
            color: white;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid rgba(255,255,255,0.7);
            border-radius: 8px;
            font-size: 14px;
            background: rgba(255,255,255,0.9);
        }
        
        .input-group input:focus, .input-group textarea:focus {
            border-color: #ff6b9d;
            outline: none;
        }
        
        .categories {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .category {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255,255,255,0.7);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .category input {
            width: 50px;
            margin-left: 10px;
            padding: 5px;
            text-align: center;
        }
        
        .counter-buttons {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .counter-btn {
            background: #667eea;
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .counter-btn:hover {
            background: #5a6fd8;
        }
        
        .btn {
            background: linear-gradient(135deg, #ff6b9d, #4ecdc4);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            width: 100%;
            margin-bottom: 15px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .history {
            background: rgba(255,255,255,0.7);
            padding: 15px;
            border-radius: 10px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .history-item {
            background: rgba(255,255,255,0.8);
            margin-bottom: 8px;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85em;
            border-left: 3px solid #ff6b9d;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #00b894;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 300px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(300px); }
            to { transform: translateX(0); }
        }
        
        .realtime-indicator {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid #4caf50;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 11px;
            color: #2e7d32;
            margin: 5px 0;
            text-align: center;
        }
        
            @media (max-width: 768px) {
                .quick-nav {
                    position: fixed;
                    bottom: 0;
                    left: 0;
                    right: 0;
                    background: rgba(255,255,255,0.95);
                    backdrop-filter: blur(10px);
                    padding: 10px;
                    box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
                    z-index: 1000;
                    margin: 0;
                }
                
                .nav-btn {
                    padding: 10px 15px;
                    font-size: 12px;
                    flex: 1;
                    min-width: 70px;
                    -webkit-tap-highlight-color: transparent;
                }
                
                /* Ajouter padding en bas pour compenser la nav fixe */
                body {
                    padding-bottom: 80px;
                }
                
                /* Fix pour iOS Safari */
                .quick-nav {
                    padding-bottom: env(safe-area-inset-bottom, 10px);
                }
            }
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .person-section:first-child {
                border-right: none;
                border-bottom: 3px solid #f1f2f6;
            }
            
            .categories {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .category {
                font-size: 0.8em;
                padding: 12px 8px;
            }
            
            .category input {
                width: 45px;
                margin-left: 5px;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .stat-number {
                font-size: 1.3em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Notre Journ√©e Bien-√ätre üíï</h1>
            
            <div class="quote" id="quote">
                "Chaque petit pas compte. Vous √™tes plus forts ensemble ! üí™‚ú®"
            </div>
            
            <div class="stats" id="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalDays">0</div>
                    <div>Jours de suivi</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="loss1">0kg</div>
                    <div>Mon Amour üß©ü´∂</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="loss2">0kg</div>
                    <div>Mi Amor ü´∂üß©</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="bestScore">0</div>
                    <div>Meilleur score</div>
                </div>
            </div>

            <!-- Navigation rapide -->
            <div class="quick-nav">
                <div class="puzzle-container">
                    <button onclick="scrollToSection('person1')" class="nav-btn nav-btn-1">üß©<br>Mon<br>Amour</button>
                    <button onclick="scrollToSection('person2')" class="nav-btn nav-btn-2">ü´∂<br>Mi<br>Amor</button>
                    <button onclick="showFullHistory()" class="nav-btn nav-btn-history">üìä<br>Historique</button>
                    <button onclick="scrollToSection('technical')" class="nav-btn nav-btn-tech">‚öôÔ∏è<br>Outils</button>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <!-- Section Mon Amour -->
            <div class="person-section" id="person1">
                <h2 class="person-title">Mon Amour üß©ü´∂</h2>
                
                <div class="score-display">
                    <div class="score-number" id="score1">0</div>
                    <div>points bien-√™tre</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress1" style="width: 0%"></div>
                    </div>
                    <div>Perte: <span id="weightLoss1">0</span> kg / 10 kg</div>
                </div>
                
                <div class="milestone" id="milestone1_25">üéØ Objectif 2.5kg</div>
                <div class="milestone" id="milestone1_50">üéØ Objectif 5kg</div>
                <div class="milestone" id="milestone1_75">üéØ Objectif 7.5kg</div>
                <div class="milestone" id="milestone1_100">üèÜ Objectif 10kg</div>
                
                <div class="input-group">
                    <label>üíó Mon poids aujourd'hui (kg)</label>
                    <input type="number" id="weight1" step="0.1" placeholder="Ex: 85.5">
                </div>
                
                <div class="input-group">
                    <label>üìè Tour de ventre (cm) - optionnel</label>
                    <input type="number" id="waist1" step="0.1" placeholder="Ex: 95">
                </div>
                
                <div class="input-group">
                    <label>üìè Tour de taille (cm) - optionnel</label>
                    <input type="number" id="waistline1" step="0.1" placeholder="Ex: 90">
                </div>
                
                <div class="input-group">
                    <label>üìè Tour de cuisse (cm) - optionnel</label>
                    <input type="number" id="thigh1" step="0.1" placeholder="Ex: 65">
                </div>
                
                <div class="input-group" style="background: rgba(255,255,255,0.7); padding: 15px; border-radius: 10px; text-align: center; border: 2px dashed #ff6b9d;">
                    <label>üì∏ Photo bien-√™tre (tous les lundis matins)</label>
                    <small>Photo enti√®re face et c√¥t√© - Pour voir tes progr√®s et te sentir fier !</small><br>
                    <input type="url" id="photoLink1" placeholder="Colle ici le lien de ta photo (Google Photos, etc.)" style="width: 100%; margin: 10px 0; padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                    <button type="button" onclick="savePhotoLink(1)" style="background: #4ecdc4; color: white; border: none; padding: 10px 20px; border-radius: 15px; cursor: pointer; margin-top: 5px;">üì∏ Sauvegarder photo</button>
                    <div id="photoHistory1" style="max-height: 150px; overflow-y: auto; margin-top: 10px; text-align: left;"></div>
                </div>
                
                <div class="categories">
                    <div class="category">
                        üçª Alcool (verres)
                        <div class="counter-buttons">
                            <button class="counter-btn" onclick="changeValue('alcohol1', -1)">-</button>
                            <input type="number" id="alcohol1" min="0" max="10" value="0" readonly>
                            <button class="counter-btn" onclick="changeValue('alcohol1', 1)">+</button>
                        </div>
                    </div>
                    <div class="category">
                        ü•® Ap√©ritif (intensit√©)
                        <div class="counter-buttons">
                            <button class="counter-btn" onclick="changeValue('appetizer1', -1)">-</button>
                            <input type="number" id="appetizer1" min="0" max="10" value="0" readonly>
                            <button class="counter-btn" onclick="changeValue('appetizer1', 1)">+</button>
                        </div>
                    </div>
                    <div class="category">
                        üç∞ Sucre (intensit√©)
                        <div class="counter-buttons">
                            <button class="counter-btn" onclick="changeValue('sugar1', -1)">-</button>
                            <input type="number" id="sugar1" min="0" max="10" value="0" readonly>
                            <button class="counter-btn" onclick="changeValue('sugar1', 1)">+</button>
                        </div>
                    </div>
                    <div class="category">
                        üç´ Dessert (intensit√©)
                        <div class="counter-buttons">
                            <button class="counter-btn" onclick="changeValue('dessert1', -1)">-</button>
                            <input type="number" id="dessert1" min="0" max="10" value="0" readonly>
                            <button class="counter-btn" onclick="changeValue('dessert1', 1)">+</button>
                        </div>
                    </div>
                    <div class="category">
                        ü•ó L√©gumes (portions)
                        <div class="counter-buttons">
                            <button class="counter-btn" onclick="changeValue('vegetables1', -1)">-</button>
                            <input type="number" id="vegetables1" min="0" max="10" value="0" readonly>
                            <button class="counter-btn" onclick="changeValue('vegetables1', 1)">+</button>
                        </div>
                    </div>
                    <div class="category">
                        üèÉ Sport (intensit√©)
                        <div class="counter-buttons">
                            <button class="counter-btn" onclick="changeValue('sport1', -1)">-</button>
                            <input type="number" id="sport1" min="0" max="10" value="0" readonly>
                            <button class="counter-btn" onclick="changeValue('sport1', 1)">+</button>
                        </div>
                    </div>
                    <div class="category">
                        üò¥ Sommeil (heures)
                        <div class="counter-buttons">
                            <button class="counter-btn" onclick="changeValue('sleep1', -0.5)">-</button>
                            <input type="number" id="sleep1" min="0" max="15" step="0.5" value="0" readonly>
                            <button class="counter-btn" onclick="changeValue('sleep1', 0.5)">+</button>
                        </div>
                    </div>
                    <div class="category">
                        üåô Qualit√© sommeil
                        <div class="counter-buttons">
                            <button class="counter-btn" onclick="changeValue('sleepQuality1', -1)">-</button>
                            <input type="number" id="sleepQuality1" min="1" max="10" value="5" readonly>
                            <button class="counter-btn" onclick="changeValue('sleepQuality1', 1)">+</button>
                        </div>
                    </div>
                </div>
                
                <div style="background: rgba(255,255,255,0.6); padding: 10px; border-radius: 8px; font-size: 0.75em; color: #666; margin-bottom: 15px;">
                    <strong>üìñ Guide :</strong><br>
                    <strong>Verres:</strong> nombre r√©el ‚Ä¢ <strong>Intensit√©:</strong> 0=rien, 3=normal, 6=beaucoup, 10=√©norme<br>
                    <strong>Portions:</strong> 1=assiette l√©gumes ‚Ä¢ <strong>Sport:</strong> 0=canap√©, 5=marche, 10=intense<br>
                    <strong>Sommeil:</strong> heures r√©elles ‚Ä¢ <strong>Qualit√©:</strong> 1=horrible, 5=correct, 8=tr√®s bien, 10=parfait
                </div>
                
                <div class="input-group">
                    <label>üëü Mes pas aujourd'hui</label>
                    <input type="number" id="steps2" placeholder="Ex: 7500">
                </div>
                
                <div class="input-group">
                    <label>üí≠ Comment je me sens</label>
                    <textarea id="comment2" rows="2" placeholder="Ma journ√©e..."></textarea>
                </div>
                
                <button class="btn" onclick="saveData(2)" id="saveBtn2">üíæ Sauvegarder</button>
                
                <div class="history" id="history2"></div>
            </div>
        </div>
    </div>
    
    <!-- Section technique en bas -->
    <div class="container" style="margin-top: 20px;" id="technical">
        <div class="sync-info">
            <h3 style="text-align: center; color: #667eea; margin-bottom: 15px;">üîß Outils et Synchronisation</h3>
            <div class="sync-status" id="syncStatus">üîÑ Connexion Firebase...</div>
            
            <!-- Configuration Firebase √† personnaliser -->
            <div class="setup-warning" id="setupWarning">
                <strong>‚ö†Ô∏è Configuration Firebase Requise</strong><br>
                <small>Remplacez les cl√©s Firebase ci-dessous par les v√¥tres pour activer la synchronisation</small>
            </div>
            
            <div class="firebase-info" id="firebaseInfo" style="display: none;">
                <strong>üî• Synchronisation Firebase Active !</strong><br>
                <small>‚úÖ Temps r√©el automatique ‚Ä¢ ‚úÖ Donn√©es cloud s√©curis√©es ‚Ä¢ ‚úÖ Historique permanent</small>
            </div>
            
            <div class="realtime-indicator" id="realtimeIndicator">
                üåê Pr√™t pour la synchronisation temps r√©el
            </div>
            
            <div style="font-size: 13px; margin-bottom: 10px;">
                <strong>üîó Lien de partage automatique :</strong><br>
                <small>Partagez ce lien - synchronisation automatique !</small>
            </div>
            <div class="share-link" id="shareLink">G√©n√©ration du lien...</div>
            <button class="copy-btn" onclick="copyLink()">üìã Copier le lien</button>
            <button class="copy-btn" onclick="exportData()">üì§ Exporter donn√©es</button>
            <button class="copy-btn" onclick="showFullHistory()">üìä Historique complet</button>
            <button class="copy-btn" onclick="resetChallenge()">üîÑ Nouveau d√©fi</button>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        // üî• CONFIGURATION FIREBASE ACTIV√âE ‚úÖ
        const firebaseConfig = {
            apiKey: "AIzaSyDPVDnzpGkupSteY0f32ui6FCGHR}6S8ug",
            authDomain: "bien-etre-couple.firebaseapp.com",
            projectId: "bien-etre-couple",
            storageBucket: "bien-etre-couple.firebasestorage.app",
            messagingSenderId: "242360526489",
            appId: "1:242360526489:web:342f543376850225413a08",
            measurementId: "G-MJYGT3YMPP"
        };

        // Variables globales
        let db = null;
        let unsubscribe = null;
        let challengeId = null;
        let isFirebaseConfigured = false;
        
        // Donn√©es globales avec synchronisation
        let data = {
            person1: { name: "Mon Amour üß©ü´∂", startWeight: null, currentWeight: null, history: [], totalScore: 0, photos: [] },
            person2: { name: "Mi Amor ü´∂üß©", startWeight: null, currentWeight: null, history: [], totalScore: 0, photos: [] },
            startDate: new Date().toISOString().split('T')[0],
            lastSync: Date.now(),
            challengeId: null
        };
        
        // Citations inspirantes
        const quotes = [
            "Chaque petit pas compte. Vous √™tes plus forts ensemble ! üí™‚ú®",
            "La beaut√© commence quand vous d√©cidez d'√™tre vous-m√™mes. üå∏",
            "Votre corps est capable de choses extraordinaires ! üíé",
            "Chaque jour est une nouvelle chance de prendre soin de vous. üåü",
            "Ensemble, vous retrouvez votre force ! ‚ö°",
            "Soyez fiers de chaque effort, m√™me le plus petit. üåà",
            "Votre bien-√™tre est un investissement pour votre couple. üíù"
        ];

        // V√©rifier si Firebase est configur√©
        function checkFirebaseConfig() {
            isFirebaseConfigured = firebaseConfig.apiKey !== "VOTRE_API_KEY" && 
                                   firebaseConfig.projectId !== "VOTRE_PROJECT_ID";
            
            if (isFirebaseConfigured) {
                document.getElementById('setupWarning').style.display = 'none';
                document.getElementById('firebaseInfo').style.display = 'block';
                return true;
            } else {
                document.getElementById('setupWarning').style.display = 'block';
                document.getElementById('firebaseInfo').style.display = 'none';
                updateSyncStatus('offline');
                return false;
            }
        }

        // Initialiser Firebase
        function initFirebase() {
            if (!checkFirebaseConfig()) {
                console.log('Firebase non configur√© - mode local');
                fallbackToLocalMode();
                return;
            }

            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                updateSyncStatus('connecting');
                
                // Test de connexion
                db.enableNetwork().then(() => {
                    updateSyncStatus('online');
                    initializeChallenge();
                }).catch((error) => {
                    console.error('Erreur Firebase:', error);
                    updateSyncStatus('offline');
                    fallbackToLocalMode();
                });
            } catch (error) {
                console.error('Erreur initialisation Firebase:', error);
                updateSyncStatus('offline');
                fallbackToLocalMode();
            }
        }

        // Mode de secours local
        function fallbackToLocalMode() {
            challengeId = getChallengeIdFromUrl() || generateChallengeId();
            data.challengeId = challengeId;
            loadFromLocalStorage();
            updateDisplay();
            updatePhotoHistory(1);
            updatePhotoHistory(2);
            updateQuote();
            updateShareLink();
            showNotification('üì± Mode local activ√© - Configurez Firebase pour la synchronisation');
        }

        // G√©n√©ration ID unique
        function generateChallengeId() {
            return 'challenge_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
        }

        // Obtenir ID depuis URL
        function getChallengeIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // Initialiser d√©fi
        function initializeChallenge() {
            challengeId = getChallengeIdFromUrl();
            
            if (!challengeId) {
                challengeId = generateChallengeId();
                updateUrl();
            }
            
            data.challengeId = challengeId;
            
            if (isFirebaseConfigured && db) {
                setupRealtimeListener();
            } else {
                loadFromLocalStorage();
            }
            
            updateDisplay();
            updateQuote();
            updateShareLink();
        }

        // √âcoute temps r√©el Firebase
        function setupRealtimeListener() {
            if (!isFirebaseConfigured || !db) return;

            const docRef = db.collection('challenges').doc(challengeId);
            
            unsubscribe = docRef.onSnapshot((doc) => {
                if (doc.exists) {
                    const firebaseData = doc.data();
                    if (firebaseData.lastSync > data.lastSync) {
                        data = firebaseData;
                        updateDisplay();
                        updateMilestones(1);
                        updateMilestones(2);
                        showNotification('üîÑ Donn√©es synchronis√©es !');
                    }
                } else {
                    // Document n'existe pas, le cr√©er
                    saveToFirebase();
                }
            }, (error) => {
                console.error('Erreur listener:', error);
                updateSyncStatus('offline');
                fallbackToLocalMode();
            });
        }

        // Sauvegarder dans Firebase
        function saveToFirebase() {
            if (!isFirebaseConfigured || !db) {
                saveToLocalStorage();
                return;
            }

            data.lastSync = Date.now();
            
            db.collection('challenges').doc(challengeId).set(data)
                .then(() => {
                    console.log('Donn√©es sauvegard√©es Firebase');
                    updateSyncStatus('online');
                })
                .catch((error) => {
                    console.error('Erreur sauvegarde Firebase:', error);
                    saveToLocalStorage();
                    updateSyncStatus('offline');
                });
        }

        // Sauvegarder localement
        function saveToLocalStorage() {
            try {
                localStorage.setItem('coupleWellnessData_' + challengeId, JSON.stringify(data));
            } catch (error) {
                console.error('Erreur localStorage:', error);
            }
        }

        // Charger depuis localStorage
        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem('coupleWellnessData_' + challengeId);
                if (saved) {
                    const localData = JSON.parse(saved);
                    if (localData.lastSync > data.lastSync) {
                        data = localData;
                    }
                }
            } catch (error) {
                console.error('Erreur chargement localStorage:', error);
            }
        }

        // Mise √† jour statut sync
        function updateSyncStatus(status) {
            const statusElement = document.getElementById('syncStatus');
            const indicator = document.getElementById('realtimeIndicator');
            
            switch (status) {
                case 'online':
                    statusElement.textContent = 'üü¢ Synchronis√© en temps r√©el';
                    statusElement.className = 'sync-status sync-online';
                    indicator.textContent = '‚ö° Synchronisation active - Temps r√©el !';
                    indicator.style.color = '#2e7d32';
                    break;
                case 'offline':
                    statusElement.textContent = 'üî¥ Mode local';
                    statusElement.className = 'sync-status sync-offline';
                    indicator.textContent = 'üì± Mode local - Configurez Firebase pour sync';
                    indicator.style.color = '#d32f2f';
                    break;
                case 'connecting':
                    statusElement.textContent = 'üü° Connexion...';
                    statusElement.className = 'sync-status sync-connecting';
                    indicator.textContent = 'üîÑ Connexion √† Firebase...';
                    indicator.style.color = '#f57c00';
                    break;
            }
        }

        // Mise √† jour URL
        function updateUrl() {
            const url = new URL(window.location);
            url.searchParams.set('id', challengeId);
            window.history.replaceState({}, '', url.toString());
            updateShareLink();
        }

        // Mise √† jour lien partage
        function updateShareLink() {
            const currentUrl = window.location.href;
            document.getElementById('shareLink').textContent = currentUrl;
        }

        // Boutons +/- pour mobile
        function changeValue(inputId, delta) {
            const input = document.getElementById(inputId);
            const currentValue = parseFloat(input.value) || 0;
            const min = parseFloat(input.min) || 0;
            const max = parseFloat(input.max) || 100;
            const step = parseFloat(input.step) || 1;
            
            let newValue = currentValue + delta;
            newValue = Math.max(min, Math.min(max, newValue));
            
            // Arrondir selon le step
            if (step === 0.5) {
                newValue = Math.round(newValue * 2) / 2;
            } else {
                newValue = Math.round(newValue);
            }
            
            input.value = newValue;
        }

        // Calcul score
        function calculateScore(person, values) {
            let score = 10; // Base
            
            // P√©nalit√©s
            score -= values.alcohol * 3;
            score -= values.appetizer * 2;
            score -= values.sugar * 2;
            score -= values.dessert * 2;
            
            // Bonus
            score += values.vegetables * 4;
            score += values.sport * 6;
            if (values.steps) score += Math.min(Math.floor(values.steps / 1000), 8);
            
            // Bonus sommeil
            if (values.sleep >= 7 && values.sleep <= 9) score += 8;
            else if (values.sleep >= 6 && values.sleep <= 10) score += 4;
            else if (values.sleep > 0) score += 1;
            
            // Bonus qualit√© sommeil
            if (values.sleepQuality >= 8) score += 6;
            else if (values.sleepQuality >= 6) score += 3;
            else if (values.sleepQuality >= 4) score += 1;
            
            // Bonus sp√©ciaux
            if (values.vegetables >= 3) score += 5;
            if (values.sport >= 1) score += 5;
            if (values.alcohol === 0 && values.sugar === 0 && values.dessert === 0) score += 10;
            if (values.sleep >= 7 && values.sleepQuality >= 7) score += 5;
            
            return Math.max(5, score);
        }

        // Sauvegarde donn√©es quotidiennes
        function saveData(person) {
            const weight = parseFloat(document.getElementById(`weight${person}`).value);
            
            if (!weight || weight <= 0) {
                showNotification('Merci de saisir un poids valide ! üíó');
                return;
            }

            // D√©sactiver bouton pendant sauvegarde
            const saveBtn = document.getElementById(`saveBtn${person}`);
            saveBtn.disabled = true;
            saveBtn.textContent = 'üíæ Sauvegarde...';
            
            if (!data[`person${person}`].startWeight) {
                data[`person${person}`].startWeight = weight;
            }
            
            data[`person${person}`].currentWeight = weight;
            
            // R√©cup√©rer valeurs
            let values = {};
            if (person === 1) {
                values = {
                    alcohol: parseInt(document.getElementById('alcohol1').value) || 0,
                    appetizer: parseInt(document.getElementById('appetizer1').value) || 0,
                    sugar: parseInt(document.getElementById('sugar1').value) || 0,
                    dessert: parseInt(document.getElementById('dessert1').value) || 0,
                    vegetables: parseInt(document.getElementById('vegetables1').value) || 0,
                    sport: parseInt(document.getElementById('sport1').value) || 0,
                    sleep: parseFloat(document.getElementById('sleep1').value) || 0,
                    sleepQuality: parseInt(document.getElementById('sleepQuality1').value) || 5,
                    steps: parseInt(document.getElementById('steps1').value) || 0,
                    waist: parseFloat(document.getElementById('waist1').value) || null,
                    waistline: parseFloat(document.getElementById('waistline1').value) || null,
                    thigh: parseFloat(document.getElementById('thigh1').value) || null,
                    comment: document.getElementById('comment1').value || ''
                };
            } else {
                values = {
                    alcohol: parseInt(document.getElementById('alcohol2').value) || 0,
                    appetizer: parseInt(document.getElementById('appetizer2').value) || 0,
                    sugar: parseInt(document.getElementById('sugar2').value) || 0,
                    dessert: parseInt(document.getElementById('dessert2').value) || 0,
                    vegetables: parseInt(document.getElementById('vegetables2').value) || 0,
                    sport: parseInt(document.getElementById('sport2').value) || 0,
                    sleep: parseFloat(document.getElementById('sleep2').value) || 0,
                    sleepQuality: parseInt(document.getElementById('sleepQuality2').value) || 5,
                    steps: parseInt(document.getElementById('steps2').value) || 0,
                    waist: parseFloat(document.getElementById('waist2').value) || null,
                    waistline: parseFloat(document.getElementById('waistline2').value) || null,
                    thigh: parseFloat(document.getElementById('thigh2').value) || null,
                    comment: document.getElementById('comment2').value || ''
                };
            }
            
            const dailyScore = calculateScore(person, values);
            
            // Ajouter √† l'historique
            const today = new Date().toISOString().split('T')[0];
            const existingIndex = data[`person${person}`].history.findIndex(h => h.date === today);
            
            const entry = {
                date: today,
                weight: weight,
                score: dailyScore,
                values: values
            };
            
            if (existingIndex >= 0) {
                data[`person${person}`].history[existingIndex] = entry;
            } else {
                data[`person${person}`].history.push(entry);
            }
            
            // Recalculer score total
            data[`person${person}`].totalScore = data[`person${person}`].history.reduce((sum, h) => sum + h.score, 0);
            
            // Sauvegarder
            if (isFirebaseConfigured && db) {
                saveToFirebase();
            } else {
                saveToLocalStorage();
                updateUrl(); // Mise √† jour URL en mode local
            }
            
            updateDisplay();
            updateMilestones(person);
            
            // Messages encouragement
            setTimeout(() => {
                saveBtn.disabled = false;
                saveBtn.textContent = 'üíæ Sauvegarder';
                
                if (person === 2) {
                    if (dailyScore >= 20) {
                        showNotification('üåü Incroyable journ√©e ! Tu rayonnes ! ‚ú®');
                    } else if (dailyScore >= 15) {
                        showNotification('üíñ Belle journ√©e ! Continue comme √ßa !');
                    } else {
                        showNotification('üíï Chaque effort compte ! Tu es formidable !');
                    }
                } else {
                    if (dailyScore >= 20) {
                        showNotification('üí™ Excellent travail ! Tu assures !');
                    } else {
                        showNotification('üëç Bien jou√© ! Continue sur cette lanc√©e !');
                    }
                }
                
                resetForm(person);
            }, 1000);
        }

        // Reset formulaire
        function resetForm(person) {
            document.getElementById(`weight${person}`).value = '';
            document.getElementById(`waist${person}`).value = '';
            document.getElementById(`waistline${person}`).value = '';
            document.getElementById(`thigh${person}`).value = '';
            document.getElementById(`steps${person}`).value = '';
            document.getElementById(`comment${person}`).value = '';
            
            // Reset des cat√©gories
            document.getElementById(`alcohol${person}`).value = '0';
            document.getElementById(`appetizer${person}`).value = '0';
            document.getElementById(`sugar${person}`).value = '0';
            document.getElementById(`dessert${person}`).value = '0';
            document.getElementById(`vegetables${person}`).value = '0';
            document.getElementById(`sport${person}`).value = '0';
            document.getElementById(`sleep${person}`).value = '0';
            document.getElementById(`sleepQuality${person}`).value = '5';
        }

        // Mise √† jour affichage
        function updateDisplay() {
            for (let i = 1; i <= 2; i++) {
                const person = data[`person${i}`];
                const weightLoss = person.startWeight && person.currentWeight ? 
                    Math.max(0, person.startWeight - person.currentWeight) : 0;
                const progress = Math.min(100, (weightLoss / 10) * 100);
                
                document.getElementById(`score${i}`).textContent = person.totalScore;
                document.getElementById(`weightLoss${i}`).textContent = weightLoss.toFixed(1);
                document.getElementById(`progress${i}`).style.width = progress + '%';
                
                // Historique
                const historyDiv = document.getElementById(`history${i}`);
                historyDiv.innerHTML = person.history.slice().reverse().map(h => {
                    const date = new Date(h.date).toLocaleDateString('fr-FR');
                    
                    const dataDetails = `üçª ${h.values.alcohol || 0} alcool | ü•® ${h.values.appetizer || 0} ap√©ritif | üç∞ ${h.values.sugar || 0} sucre | üç´ ${h.values.dessert || 0} dessert | ü•ó ${h.values.vegetables || 0} l√©gumes | üèÉ ${h.values.sport || 0} sport | üò¥ ${h.values.sleep || 0}h | üåô ${h.values.sleepQuality || 0}/10`;
                    
                    let measurements = '';
                    if (h.values.waist) measurements += ` | üìè Ventre: ${h.values.waist}cm`;
                    if (h.values.waistline) measurements += ` | Taille: ${h.values.waistline}cm`;
                    if (h.values.thigh) measurements += ` | Cuisse: ${h.values.thigh}cm`;
                    if (h.values.steps) measurements += ` | üëü ${h.values.steps} pas`;
                    
                    let commentText = h.values.comment ? `<br><em style="color: #555; font-style: italic;">"${h.values.comment}"</em>` : '';
                    
                    return `<div class="history-item">
                        <strong style="color: #333;">${date}</strong><br>
                        <strong>Poids:</strong> ${h.weight}kg | <strong>Score:</strong> ${h.score} points<br>
                        <span style="font-size: 0.85em; color: #666;">${dataDetails}</span>
                        ${measurements ? `<br><span style="font-size: 0.8em; color: #888;">${measurements}</span>` : ''}
                        ${commentText}
                    </div>`;
                }).join('');
            }
            
            // Stats globales
            const totalDays = Math.max(data.person1.history.length, data.person2.history.length);
            const loss1 = data.person1.startWeight && data.person1.currentWeight ? 
                (data.person1.startWeight - data.person1.currentWeight).toFixed(1) : 0;
            const loss2 = data.person2.startWeight && data.person2.currentWeight ? 
                (data.person2.startWeight - data.person2.currentWeight).toFixed(1) : 0;
            const bestScore = Math.max(
                data.person1.history.length > 0 ? Math.max(...data.person1.history.map(h => h.score)) : 0,
                data.person2.history.length > 0 ? Math.max(...data.person2.history.map(h => h.score)) : 0
            );
            
            document.getElementById('totalDays').textContent = totalDays;
            document.getElementById('loss1').textContent = loss1 + 'kg';
            document.getElementById('loss2').textContent = loss2 + 'kg';
            document.getElementById('bestScore').textContent = bestScore;
        }

        // Navigation rapide
        function scrollToSection(sectionId) {
            console.log('Tentative de scroll vers:', sectionId);
            const element = document.getElementById(sectionId);
            console.log('√âl√©ment trouv√©:', element);
            
            if (element) {
                // M√©thode alternative pour iOS
                const yOffset = -20; // Petit d√©calage pour √©viter que le titre soit coll√© en haut
                const yPosition = element.getBoundingClientRect().top + window.pageYOffset + yOffset;
                
                window.scrollTo({
                    top: yPosition,
                    behavior: 'smooth'
                });
                
                // Fallback pour les anciens navigateurs
                setTimeout(() => {
                    element.scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 100);
            } else {
                console.error('√âl√©ment non trouv√©:', sectionId);
                // En cas d'√©chec, essayer de scroller manuellement
                if (sectionId === 'person1') {
                    window.scrollTo({ top: 400, behavior: 'smooth' });
                } else if (sectionId === 'person2') {
                    window.scrollTo({ top: 800, behavior: 'smooth' });
                } else if (sectionId === 'technical') {
                    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                }
            }
        }
        function savePhotoLink(person) {
            const photoLinkInput = document.getElementById(`photoLink${person}`);
            const photoLink = photoLinkInput.value.trim();
            
            if (!photoLink) {
                showNotification('üì∏ Merci d\'ajouter un lien vers votre photo !');
                return;
            }
            
            const today = new Date();
            const todayString = today.toISOString().split('T')[0];
            const isMonday = today.getDay() === 1;
            
            // V√©rifier si on a d√©j√† une photo aujourd'hui
            const todayPhoto = data[`person${person}`].photos.find(p => p.date === todayString);
            
            if (todayPhoto) {
                showNotification('üì∏ Photo d√©j√† ajout√©e aujourd\'hui ! √Ä lundi prochain ! ‚ú®');
                return;
            }
            
            if (!isMonday) {
                const daysUntilMonday = today.getDay() === 0 ? 1 : (8 - today.getDay());
                showNotification(`üìÖ Les photos se prennent le lundi matin ! Plus que ${daysUntilMonday} jour(s) ! üòä`);
                return;
            }
            
            // Ajouter la photo
            const photoEntry = {
                date: todayString,
                link: photoLink,
                timestamp: Date.now()
            };
            
            if (!data[`person${person}`].photos) {
                data[`person${person}`].photos = [];
            }
            
            data[`person${person}`].photos.push(photoEntry);
            data.lastSync = Date.now();
            
            // Sauvegarder
            if (isFirebaseConfigured && db) {
                saveToFirebase();
            } else {
                saveToLocalStorage();
                updateUrl();
            }
            
            // Nettoyer le champ
            photoLinkInput.value = '';
            
            // Mettre √† jour l'affichage
            updatePhotoHistory(person);
            
            showNotification('üì∏ Photo du lundi sauvegard√©e ! Excellent travail ! ‚ú®');
        }

        // Mise √† jour historique photos
        function updatePhotoHistory(person) {
            const photoHistoryDiv = document.getElementById(`photoHistory${person}`);
            const photos = data[`person${person}`].photos || [];
            
            if (photos.length === 0) {
                photoHistoryDiv.innerHTML = '<small style="color: #666;">Aucune photo encore</small>';
                return;
            }
            
            photoHistoryDiv.innerHTML = photos.slice().reverse().map(photo => {
                const date = new Date(photo.date).toLocaleDateString('fr-FR');
                return `<div style="margin: 5px 0; padding: 8px; background: rgba(255,255,255,0.8); border-radius: 5px; border-left: 3px solid #4ecdc4;">
                    <strong>${date}</strong><br>
                    <a href="${photo.link}" target="_blank" style="color: #4ecdc4; text-decoration: none; font-size: 12px;">üì∏ Voir la photo</a>
                </div>`;
            }).join('');
        }

        // Prise de photo (ancienne fonction, maintenant simplifi√©e)
        function takePhoto(person) {
            showNotification('üì∏ Utilisez le champ "lien photo" ci-dessous pour ajouter votre photo ! üòä');
        }

        // Historique complet partag√©
        function showFullHistory() {
            let historyHtml = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="closeFullHistory(event)">
                    <div style="background: white; padding: 30px; border-radius: 20px; max-width: 90%; max-height: 90%; overflow-y: auto; position: relative;" onclick="event.stopPropagation();">
                        <button onclick="closeFullHistory()" style="position: absolute; top: 15px; right: 20px; background: #ff6b9d; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 16px;">√ó</button>
                        <h2 style="text-align: center; margin-bottom: 20px; color: #333;">üìä Historique Complet du Couple</h2>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            `;
            
            // Historique pour chaque personne
            for (let i = 1; i <= 2; i++) {
                const person = data[`person${i}`];
                historyHtml += `
                    <div>
                        <h3 style="color: #ff6b9d; text-align: center; margin-bottom: 15px;">${person.name}</h3>
                        <div style="max-height: 400px; overflow-y: auto;">
                `;
                
                if (person.history.length === 0) {
                    historyHtml += '<p style="text-align: center; color: #666;">Aucune donn√©e encore</p>';
                } else {
                    person.history.slice().reverse().forEach(h => {
                        const date = new Date(h.date).toLocaleDateString('fr-FR');
                        historyHtml += `
                            <div style="background: #f8f9fa; margin: 8px 0; padding: 12px; border-radius: 8px; border-left: 3px solid #ff6b9d;">
                                <strong>${date}</strong><br>
                                <strong>Poids:</strong> ${h.weight}kg | <strong>Score:</strong> ${h.score} points<br>
                                <small style="color: #666;">
                                    üçª ${h.values.alcohol || 0} | ü•® ${h.values.appetizer || 0} | üç∞ ${h.values.sugar || 0} | üç´ ${h.values.dessert || 0}<br>
                                    ü•ó ${h.values.vegetables || 0} | üèÉ ${h.values.sport || 0} | üò¥ ${h.values.sleep || 0}h | üåô ${h.values.sleepQuality || 0}/10
                                </small>
                                ${h.values.comment ? `<br><em style="color: #555;">"${h.values.comment}"</em>` : ''}
                            </div>
                        `;
                    });
                }
                
                // Ajouter photos
                const photos = person.photos || [];
                if (photos.length > 0) {
                    historyHtml += '<h4 style="color: #4ecdc4; margin: 15px 0 10px 0;">üì∏ Photos</h4>';
                    photos.slice().reverse().forEach(photo => {
                        const date = new Date(photo.date).toLocaleDateString('fr-FR');
                        historyHtml += `
                            <div style="background: #e8f5e8; margin: 5px 0; padding: 8px; border-radius: 5px; border-left: 3px solid #4ecdc4;">
                                <strong>${date}</strong><br>
                                <a href="${photo.link}" target="_blank" style="color: #4ecdc4; text-decoration: none;">üì∏ Voir la photo</a>
                            </div>
                        `;
                    });
                }
                
                historyHtml += '</div></div>';
            }
            
            historyHtml += `
                        </div>
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="exportFullHistory()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; margin: 5px;">üìÑ Exporter PDF</button>
                            <button onclick="closeFullHistory()" style="background: #fd79a8; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; margin: 5px;">Fermer</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', historyHtml);
        }

        // Fermer historique complet
        function closeFullHistory(event) {
            if (!event || event.target.getAttribute('onclick') === 'closeFullHistory(event)' || event.target.getAttribute('onclick') === 'closeFullHistory()') {
                const modal = document.querySelector('[style*="position: fixed"][style*="z-index: 10000"]');
                if (modal) {
                    modal.remove();
                }
            }
        }

        // Export historique complet
        function exportFullHistory() {
            const exportData = {
                exportDate: new Date().toISOString(),
                couple: {
                    person1: data.person1,
                    person2: data.person2
                },
                summary: {
                    totalDays: Math.max(data.person1.history.length, data.person2.history.length),
                    totalPhotos: (data.person1.photos?.length || 0) + (data.person2.photos?.length || 0),
                    person1WeightLoss: data.person1.startWeight && data.person1.currentWeight ? 
                        (data.person1.startWeight - data.person1.currentWeight).toFixed(1) : 0,
                    person2WeightLoss: data.person2.startWeight && data.person2.currentWeight ? 
                        (data.person2.startWeight - data.person2.currentWeight).toFixed(1) : 0
                }
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `historique-couple-complet-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('üìÑ Historique complet export√© !');
        }

        // Jalons
        function updateMilestones(person) {
            const personData = data[`person${person}`];
            const weightLoss = personData.startWeight && personData.currentWeight ? 
                personData.startWeight - personData.currentWeight : 0;
            
            const milestones = [2.5, 5, 7.5, 10];
            
            milestones.forEach(milestone => {
                const element = document.getElementById(`milestone${person}_${milestone.toString().replace('.', '')}`);
                if (weightLoss >= milestone) {
                    element.classList.add('achieved');
                    element.innerHTML = `üéâ ${milestone}kg atteint !`;
                } else {
                    element.classList.remove('achieved');
                    element.innerHTML = `üéØ Objectif ${milestone}kg`;
                }
            });
        }

        // Citation quotidienne
        function updateQuote() {
            const today = new Date();
            const quoteIndex = today.getDate() % quotes.length;
            document.getElementById('quote').textContent = quotes[quoteIndex];
        }

        // Copier lien
        function copyLink() {
            const shareLink = document.getElementById('shareLink').textContent;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(shareLink).then(() => {
                    showNotification('üîó Lien copi√© ! Envoyez-le √† votre partenaire !');
                });
            } else {
                const textArea = document.createElement('textarea');
                textArea.value = shareLink;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('üîó Lien copi√© !');
            }
        }

        // Export donn√©es
        function exportData() {
            const exportData = {
                exportDate: new Date().toISOString(),
                data: data
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `bien-etre-export-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('üì§ Donn√©es export√©es !');
        }

        // Nouveau d√©fi
        function resetChallenge() {
            if (confirm('√ätes-vous s√ªr de vouloir cr√©er un nouveau d√©fi ? Toutes les donn√©es actuelles seront perdues.')) {
                // Nettoyer ancien listener
                if (unsubscribe) {
                    unsubscribe();
                }
                
                // Nouveau challenge
                challengeId = generateChallengeId();
                data = {
                    person1: { name: "Mon Amour üß©ü´∂", startWeight: null, currentWeight: null, history: [], totalScore: 0, photos: [] },
                    person2: { name: "Mi Amor ü´∂üß©", startWeight: null, currentWeight: null, history: [], totalScore: 0, photos: [] },
                    startDate: new Date().toISOString().split('T')[0],
                    lastSync: Date.now(),
                    challengeId: challengeId
                };
                
                updateUrl();
                
                if (isFirebaseConfigured && db) {
                    saveToFirebase();
                    setupRealtimeListener();
                } else {
                    saveToLocalStorage();
                }
                
                updateDisplay();
                showNotification('üÜï Nouveau d√©fi cr√©√© ! Partagez le nouveau lien !');
            }
        }

        // Notification
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 4000);
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            initFirebase();
        });

        // Nettoyage
        window.addEventListener('beforeunload', function() {
            if (unsubscribe) {
                unsubscribe();
            }
        });
    </script>
</body>
</html>255,0.6); padding: 10px; border-radius: 8px; font-size: 0.75em; color: #666; margin-bottom: 15px;">
                    <strong>üìñ Guide :</strong><br>
                    <strong>Verres:</strong> nombre r√©el ‚Ä¢ <strong>Intensit√©:</strong> 0=rien, 3=normal, 6=beaucoup, 10=√©norme<br>
                    <strong>Portions:</strong> 1=assiette l√©gumes ‚Ä¢ <strong>Sport:</strong> 0=canap√©, 5=marche, 10=intense<br>
                    <strong>Sommeil:</strong> heures r√©elles ‚Ä¢ <strong>Qualit√©:</strong> 1=horrible, 5=correct, 8=tr√®s bien, 10=parfait
                </div>
                
                <div class="input-group">
                    <label>üëü Mes pas aujourd'hui</label>
                    <input type="number" id="steps1" placeholder="Ex: 8500">
                </div>
                
                <div class="input-group">
                    <label>üí≠ Comment je me sens</label>
                    <textarea id="comment1" rows="2" placeholder="Ma journ√©e..."></textarea>
                </div>
                
                <button class="btn" onclick="saveData(1)" id="saveBtn1">üíæ Sauvegarder</button>
                
                <div class="history" id="history1"></div>
            </div>
            
            <!-- Section Mi Amor -->
            <div class="person-section" id="person2">
                <h2 class="person-title">Mi Amor ü´∂üß©</h2>
                
                <div class="score-display">
                    <div class="score-number" id="score2">0</div>
                    <div>points bien-√™tre</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress2" style="width: 0%"></div>
                    </div>
                    <div>Perte: <span id="weightLoss2">0</span> kg / 10 kg</div>
                </div>
                
                <div class="milestone" id="milestone2_25">üéØ Objectif 2.5kg</div>
                <div class="milestone" id="milestone2_50">üéØ Objectif 5kg</div>
                <div class="milestone" id="milestone2_75">üéØ Objectif 7.5kg</div>
                <div class="milestone" id="milestone2_100">üèÜ Objectif 10kg</div>
                
                <div class="input-group">
                    <label>üíó Mon poids aujourd'hui (kg)</label>
                    <input type="number" id="weight2" step="0.1" placeholder="Ex: 65.2">
                </div>
                
                <div class="input-group">
                    <label>üìè Tour de ventre (cm) - optionnel</label>
                    <input type="number" id="waist2" step="0.1" placeholder="Ex: 75">
                </div>
                
                <div class="input-group">
                    <label>üìè Tour de taille (cm) - optionnel</label>
                    <input type="number" id="waistline2" step="0.1" placeholder="Ex: 70">
                </div>
                
                <div class="input-group">
                    <label>üìè Tour de cuisse (cm) - optionnel</label>
                    <input type="number" id="thigh2" step="0.1" placeholder="Ex: 60">
                </div>
                
                <div class="input-group" style="background: rgba(255,255,255,0.7); padding: 15px; border-radius: 10px; text-align: center; border: 2px dashed #ff6b9d;">
                    <label>üì∏ Photo bien-√™tre (tous les lundis matins)</label>
                    <small>Photo enti√®re face et c√¥t√© - Pour voir tes progr√®s et te sentir fi√®re !</small><br>
                    <input type="url" id="photoLink2" placeholder="Colle ici le lien de ta photo (Google Photos, etc.)" style="width: 100%; margin: 10px 0; padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                    <button type="button" onclick="savePhotoLink(2)" style="background: #4ecdc4; color: white; border: none; padding: 10px 20px; border-radius: 15px; cursor: pointer; margin-top: 5px;">üì∏ Sauvegarder photo</button>
                    <div id="photoHistory2" style="max-height: 150px; overflow-y: auto; margin-top: 10px; text-align: left;"></div>
                </div>
                
                <div class="categories">
                    <div class="category">
                        üçª Alcool (verres)
                        <div class="counter-buttons">
                            <button class="counter-btn" onclick="changeValue('alcohol2', -1)">-</button>
                            <input type="number" id="alcohol2" min="0" max="10" value="0" readonly>
                            <button class="counter-btn" onclick="changeValue('alcohol2', 1)">+</button>
                        </div>
                    </div>
                    <div class="category">
                        ü•® Ap√©ritif (intensit√©)
                        <div class="counter-buttons">
                            <button class="counter-btn" onclick="changeValue('appetizer2', -1)">-</button>
                            <input type="number" id="appetizer2" min="0" max="10" value="0" readonly>
                            <button class="counter-btn" onclick="changeValue('appetizer2', 1)">+</button>
                        </div>
                    </div>
                    <div class="category">
                        üç∞ Sucre (intensit√©)
                        <div class="counter-buttons">
                            <button class="counter-btn" onclick="changeValue('sugar2', -1)">-</button>
                            <input type="number" id="sugar2" min="0" max="10" value="0" readonly>
                            <button class="counter-btn" onclick="changeValue('sugar2', 1)">+</button>
                        </div>
                    </div>
                    <div class="category">
                        üç´ Dessert (intensit√©)
                        <div class="counter-buttons">
                            <button class="counter-btn" onclick="changeValue('dessert2', -1)">-</button>
                            <input type="number" id="dessert2" min="0" max="10" value="0" readonly>
                            <button class="counter-btn" onclick="changeValue('dessert2', 1)">+</button>
                        </div>
                    </div>
                    <div class="category">
                        ü•ó L√©gumes (portions)
                        <div class="counter-buttons">
                            <button class="counter-btn" onclick="changeValue('vegetables2', -1)">-</button>
                            <input type="number" id="vegetables2" min="0" max="10" value="0" readonly>
                            <button class="counter-btn" onclick="changeValue('vegetables2', 1)">+</button>
                        </div>
                    </div>
                    <div class="category">
                        üèÉ Sport (intensit√©)
                        <div class="counter-buttons">
                            <button class="counter-btn" onclick="changeValue('sport2', -1)">-</button>
                            <input type="number" id="sport2" min="0" max="10" value="0" readonly>
                            <button class="counter-btn" onclick="changeValue('sport2', 1)">+</button>
                        </div>
                    </div>
                    <div class="category">
                        üò¥ Sommeil (heures)
                        <div class="counter-buttons">
                            <button class="counter-btn" onclick="changeValue('sleep2', -0.5)">-</button>
                            <input type="number" id="sleep2" min="0" max="15" step="0.5" value="0" readonly>
                            <button class="counter-btn" onclick="changeValue('sleep2', 0.5)">+</button>
                        </div>
                    </div>
                    <div class="category">
                        üåô Qualit√© sommeil
                        <div class="counter-buttons">
                            <button class="counter-btn" onclick="changeValue('sleepQuality2', -1)">-</button>
                            <input type="number" id="sleepQuality2" min="1" max="10" value="5" readonly>
                            <button class="counter-btn" onclick="changeValue('sleepQuality2', 1)">+</button>
                        </div>
                    </div>
                </div>
                
                <div style="background: rgba(255,255,
